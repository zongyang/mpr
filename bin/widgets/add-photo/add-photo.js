// Generated by LiveScript 1.3.1
(function(){
  define(function(require, exports, module){
    var util, state, stateMachine, dataBinder, ui, widgetUtil;
    util = require('util');
    state = require('state');
    stateMachine = require('state/state-machine');
    dataBinder = require('data/data-binder');
    ui = require('common/ui');
    widgetUtil = require('../widget-util');
    return ui.createWidget({
      name: 'add-photo',
      fileInput: $('#add-photo .back-input input'),
      scanSeg: $('#add-photo .scan-seg'),
      upBtn: $('#add-photo .upload-seg .up'),
      mallInput: $('#add-photo .address-seg .mall'),
      shopInput: $('#add-photo .address-seg .shop'),
      addressInput: $('#add-photo .address-seg .address'),
      statesAppPagesMap: {
        'show': ['add-photo']
      },
      activate: function(){
        this.addInputfileEvent();
        this.addUpBtnEvent();
      },
      createImgColumn: function(src){
        var html, column;
        html = '<div class="column">';
        html += '<div class="ui image">';
        html += '<a class="ui left green corner label">';
        html += '<i class="checkmark icon">';
        html += '</i>';
        html += '</a>';
        html += '<img src="' + src + '">';
        html += '</img>';
        html += '</div>';
        html += '</div>';
        column = $(html);
        column.click(function(){
          return $(this).find('a').toggleClass('green');
        });
        return this.scanSeg.append(column);
      },
      selectChange: function(){},
      readAsDataURL: function(file){
        var reader, this$ = this;
        reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function(){
          this$.createImgColumn(reader.result);
        };
      },
      addInputfileEvent: function(){
        var this$ = this;
        if (typeof FileReader === 'undefined') {
          return console.log('浏览器不支持！');
        }
        this.fileInput.change(function(){
          var files, regStr, i$, to$, i;
          files = this$.fileInput[0].files;
          regStr = /image\/\w+/;
          for (i$ = 0, to$ = files.length - 1; i$ <= to$; ++i$) {
            i = i$;
            if (!regStr.test(files[i].type)) {
              return console.log('第' + i + '个文件不是图片！');
            }
            this$.readAsDataURL(files[i]);
          }
        });
      },
      addUpBtnEvent: function(){
        var this$ = this;
        this.upBtn.click(function(){
          var mall, shop, address, files, data, i$, to$, i;
          mall = this$.mallInput.val();
          shop = this$.shopInput.val();
          address = this$.addressInput.val();
          files = this$.fileInput[0].files;
          data = new FormData();
          data.append('mall', mall);
          data.append('shop', shop);
          data.append('address', address);
          for (i$ = 0, to$ = files.length - 1; i$ <= to$; ++i$) {
            i = i$;
            data.append(files[i].name, files[i]);
          }
          $.ajax({
            type: 'post',
            url: '/add-photo/uploads',
            data: data,
            processData: false,
            contentType: false,
            success: function(data){
              console.log(data);
            }
          });
        });
      }
    });
  });
}).call(this);
